import{useState as r,useRef as t,useCallback as n,forwardRef as e,useEffect as o,useImperativeHandle as i,useMemo as a}from"react";import u from"tinycolor2";import{jsx as c}from"react/jsx-runtime";function l(r,t){var n=Math.round(Math.random()*t),e=1-Math.random()/4;return u(r).darken(n-t/2).setAlpha(e).toPercentageRgbString()}var s=function(r,t,n){return[n[0]+r*Math.cos(t),n[1]+r*Math.sin(t)]};function h(r){return"url("+function(r){return"data:image/svg+xml;base64,"+btoa(function(r){return"<svg xmlns='http://www.w3.org/2000/svg' width='"+r+"' height='"+r+"' viewBox='0 0 "+r+" "+r+"'><circle r='"+r/2+"' cy='"+r/2+"' cx='"+r/2+"' stroke-width='1' stroke='rgba(0,0,0,0.5)' fill='none'/></svg>"}(r))}(r)+") "+r/2+" "+r/2+", crosshair"}function d(e){var o=e.color,i=void 0===o?"#000000":o,a=e.strokeWidth,u=void 0===a?25:a,c=e.varyBrightness,d=void 0===c?5:c,f=r([]),v=f[0],m=f[1],g=t(),p=t();return{name:"Paintbrush",startStroke:n(function(r){g.current=void 0,m(function(r,t,n){for(var e=[],o=Math.round(r/3),i=r/o,a=0;a<o;a++){var u=0===a?0:i*a+Math.random()*i/2-i/2;e.push({distance:u,thickness:2*Math.random()+2,colour:l(t,n)})}return e}(u,i,d)),p.current=r},[m,u,i,d]),continueStroke:n(function(r,t){if(p.current){var n=(l=g.current,a=p.current,c=r,h=(Math.atan2(c[1]-a[1],c[0]-a[0])-Math.PI/2)%(2*Math.PI),void 0===l?h:l-(e=h,o=2*Math.PI,(i=(l-(e>0?e:e+o)+Math.PI)%o-Math.PI)<-Math.PI?i+o:i));void 0===g.current&&(g.current=n%(2*Math.PI)),function(r,t,n,e,o,i,a){r.forEach(function(r){a.beginPath(),function(r,t,n,e,o){o.beginPath(),o.moveTo(r[0],r[1]),o.strokeStyle=n.colour,o.lineWidth=n.thickness,o.lineCap="round",o.lineJoin="round",o.shadowColor=n.colour,o.shadowBlur=n.thickness/2,o.quadraticCurveTo(e[0],e[1],t[0],t[1]),o.lineTo(t[0],t[1]),o.stroke()}(s(r.distance-i/2,e,t),s(r.distance-i/2,o,n),r,s(r.distance-i/2,o,t),a)})}(v,p.current,r,g.current,n,u,t),g.current=n%(2*Math.PI),p.current=r}else p.current=r;var e,o,i,a,c,l,h},[v,u]),cursor:h(u)}}function f(r){var e=r.color,o=void 0===e?"#000000":e,i=r.strokeWidth,a=void 0===i?25:i,u=t();return{name:"Marker",startStroke:n(function(r,t){t.lineWidth=3,t.lineJoin=t.lineCap="round",u.current=r,t.strokeStyle=o},[o]),continueStroke:n(function(r,t){if(u.current){if(u.current[0]!==r[0]||u.current[1]!==r[1]){t.beginPath();for(var n=0;n<a;n+=2){var e=Math.round(a/2-n);t.globalAlpha=1/a*(a-n),t.moveTo(u.current[0]-e,u.current[1]-e),t.lineTo(r[0]-e,r[1]-e),t.stroke()}t.globalAlpha=1,t.beginPath(),u.current=r}}else u.current=r},[a,u]),cursor:h(a)}}function v(r){var t=r.color,e=void 0===t?"#000000":t,o=r.strokeWidth,i=void 0===o?25:o,a=n(function(r,t){t.globalCompositeOperation="darken",t.lineWidth=i,t.lineJoin=t.lineCap="round",t.strokeStyle=e,t.shadowBlur=.5*i,t.shadowColor=u(e).setAlpha(.5).toPercentageRgbString(),console.log(t.shadowColor),t.moveTo(r[0],r[1]),t.beginPath()},[e,i]),c=n(function(r){r.globalCompositeOperation="source-over"},[]);return{name:"Airbrush",startStroke:a,continueStroke:n(function(r,t){t.lineTo(r[0],r[1]),t.stroke()},[]),endStroke:c,cursor:h(i)}}function m(){return(m=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(r[e]=n[e])}return r}).apply(this,arguments)}function g(r,t){(null==t||t>r.length)&&(t=r.length);for(var n=0,e=new Array(t);n<t;n++)e[n]=r[n];return e}function p(r){var e=r.color,o=void 0===e?"#000000":e,i=r.neighbourColor,a=r.distanceThreshold,c=void 0===a?40:a,l=r.neighbourStrokeWidth,s=void 0===l?1:l,h=r.spreadFactor,d=void 0===h?.9:h;i||(i=u(o).setAlpha(.2).toPercentageRgbString());var f=t([]),v=c*c;return{name:"Shading",startStroke:n(function(r,t){t.globalCompositeOperation="darken",t.lineWidth=1,t.lineJoin=t.lineCap="round",f.current=[r]},[]),continueStroke:n(function(r,t){t.strokeStyle=o,t.lineWidth=1,f.current.push(r),t.beginPath();var n=f.current[f.current.length-2];t.moveTo(n[0],n[1]),t.lineTo.apply(t,r),t.stroke(),t.lineWidth=s;for(var e,a=function(r,t){var n;if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(n=function(r,t){if(r){if("string"==typeof r)return g(r,t);var n=Object.prototype.toString.call(r).slice(8,-1);return"Object"===n&&r.constructor&&(n=r.constructor.name),"Map"===n||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(r,t):void 0}}(r))){n&&(r=n);var e=0;return function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=r[Symbol.iterator]()).next.bind(n)}(f.current);!(e=a()).done;){var u=e.value,c=u[0]-r[0],l=u[1]-r[1],h=c*c+l*l;h<v&&Math.random()>h/v&&(t.beginPath(),t.strokeStyle=i,t.moveTo(r[0]+c*d,r[1]+l*d),t.lineTo(u[0]-c*d,u[1]-l*d),t.stroke())}},[s,o,d,v,i]),endStroke:n(function(r){r.globalCompositeOperation="source-over"},[]),cursor:"crosshair"}}var k=null;function b(){var r,t,n,e,o;if(null!==k)r=k,k=null;else{do{e=(t=2*Math.random()-1)*t+(n=2*Math.random()-1)*n}while(0===e||e>=1);r=t*(o=Math.sqrt(-2*Math.log(e)/e)),k=n*o}return r}function S(r,t,n,e,o){if(n<0)return[];var i=(r[1]+t[1])/2,a=[(r[0]+t[0])/2+b()*e,i+b()*e],u=S(r,a,n-1,e/o,o);return u.push(a),u.push.apply(u,S(a,t,n-1,e/o,o)),u}function M(r,t,n){t.beginPath(),function(r,t,n){return function(r,t,n,e){for(var o=[],i=0;i<r.length;i++){var a=r[i],u=r[(i+1)%r.length];o.push(a),o.push.apply(o,S(a,u,5,n,2))}return o}(function(r,t,n){for(var e=2*Math.PI/t,o=[],i=1;i<=t;i++)o.push([n*Math.cos(e*i)+r[0],n*Math.sin(e*i)+r[1]]);return o}(r,t,n),0,n/10)}(r,Math.round(n/5),n).forEach(function(r){t.lineTo.apply(t,r)}),t.closePath(),t.fill()}function y(r,t,n,e){for(var o=Math.min(n,r.length/3),i=0;i<o;i++)e.globalAlpha=.01-.009/o*i,M(r[r.length-3*i-1],e,t+t/o*i);e.globalAlpha=.1}function C(r){var e=r.color,o=void 0===e?"#000000":e,i=r.strokeWidth,a=void 0===i?25:i,u=t([]),c=n(function(r,t){t.fillStyle=o,t.shadowColor=o,t.globalAlpha=.01,u.current=[r],y(u.current,1.1*a,1,t)},[o,a]),l=n(function(){u.current=[]},[]);return{name:"Watercolor",startStroke:c,continueStroke:n(function(r,t){u.current.push(r),y(u.current,a,5,t)},[a]),endStroke:l,cursor:h(a)}}function P(r){var t=r.strokeWidth,e=void 0===t?25:t;return{name:"Eraser",startStroke:n(function(r,t){t.globalCompositeOperation="source-over",t.lineWidth=e,t.strokeStyle="#ffffff",t.lineJoin=t.lineCap="round",t.moveTo(r[0],r[1]),t.beginPath()},[e]),continueStroke:n(function(r,t){t.lineTo(r[0],r[1]),t.stroke()},[]),cursor:h(e)}}function w(r){var t=r.color,e=void 0===t?"#2c2c2c":t,o=r.strokeWidth,i=void 0===o?3:o,a=r.opacity,u=void 0===a?.8:a;return{name:"Pencil",startStroke:n(function(r,t){t.globalAlpha=u,t.lineWidth=i,t.strokeStyle=e,t.lineCap="round",t.lineJoin="round",t.globalCompositeOperation="multiply",t.moveTo(r[0],r[1]),t.beginPath()},[e,i,u]),continueStroke:n(function(r,t){var n=.5*(Math.random()-.5);t.lineWidth=i+n,t.lineTo(r[0],r[1]),t.stroke()},[i]),endStroke:n(function(r){r.globalAlpha=1,r.globalCompositeOperation="source-over"},[]),cursor:h(i)}}function T(r){var e=r.color,o=void 0===e?"#1a1a1a":e,i=r.strokeWidth,a=void 0===i?15:i,u=r.roughness,c=void 0===u?.7:u,l=t();return{name:"Charcoal",startStroke:n(function(r,t){t.globalAlpha=.6,t.strokeStyle=o,t.lineCap="round",t.lineJoin="round",t.globalCompositeOperation="multiply",l.current=r},[o]),continueStroke:n(function(r,t){if(l.current){for(var n=Math.floor(a/3),e=0;e<n;e++){t.beginPath();var o=(Math.random()-.5)*a*c,i=(Math.random()-.5)*a*c;t.lineWidth=3*Math.random()+1,t.moveTo(l.current[0]+o,l.current[1]+i),t.lineTo(r[0]+o,r[1]+i),t.stroke()}l.current=r}else l.current=r},[a,c]),endStroke:n(function(r){r.globalAlpha=1,r.globalCompositeOperation="source-over"},[]),cursor:h(a)}}function A(r){var e=r.color,o=void 0===e?"#000000":e,i=r.strokeWidth,a=void 0===i?20:i,u=r.angle,c=void 0===u?45:u,l=t(),s=t();return{name:"Calligraphy",startStroke:n(function(r,t){t.strokeStyle=o,t.lineCap="round",t.lineJoin="round",l.current=r,s.current=Date.now()},[o]),continueStroke:n(function(r,t){if(!l.current||!s.current)return l.current=r,void(s.current=Date.now());var n=Date.now(),e=Math.max(n-s.current,1),o=r[0]-l.current[0],i=r[1]-l.current[1],u=Math.sqrt(o*o+i*i)/e,h=Math.atan2(i,o),d=Math.abs(h-c*Math.PI/180),f=Math.min(d,Math.PI-d),v=.8*Math.sin(f)+.2,m=Math.max(.3,1-.02*u),g=a*v*m;t.beginPath(),t.lineWidth=g,t.moveTo(l.current[0],l.current[1]),t.lineTo(r[0],r[1]),t.stroke(),l.current=r,s.current=n},[a,c]),cursor:h(a)}}function W(r){var e=r.color,o=void 0===e?"#000080":e,i=r.strokeWidth,a=void 0===i?4:i,u=r.flow,c=void 0===u?.9:u,l=t(),s=t(1);return{name:"Ink Pen",startStroke:n(function(r,t){t.globalAlpha=c,t.strokeStyle=o,t.lineCap="round",t.lineJoin="round",t.shadowColor=o,t.shadowBlur=1,l.current=r,s.current=.5},[o,c]),continueStroke:n(function(r,t){if(l.current){var n=r[0]-l.current[0],e=r[1]-l.current[1],o=Math.sqrt(n*n+e*e),i=Math.max(.3,Math.min(1,1-.01*o));s.current=.7*s.current+.3*i;var u=a*s.current;t.beginPath(),t.lineWidth=u;var c=(l.current[0]+r[0])/2,h=(l.current[1]+r[1])/2;t.moveTo(l.current[0],l.current[1]),t.quadraticCurveTo(l.current[0],l.current[1],c,h),t.stroke(),l.current=r}else l.current=r},[a]),endStroke:n(function(r){r.globalAlpha=1,r.shadowBlur=0},[]),cursor:h(a)}}function O(r){var e=r.color,o=void 0===e?"#8B4513":e,i=r.strokeWidth,a=void 0===i?25:i,c=r.blending,l=void 0===c?.6:c,s=t();return{name:"Oil Paint",startStroke:n(function(r,t){t.globalAlpha=.8,t.strokeStyle=o,t.lineCap="round",t.lineJoin="round",t.globalCompositeOperation="source-over",s.current=r},[o]),continueStroke:n(function(r,t){if(s.current){for(var n=0;n<5;n++){t.beginPath();var e=u(o),i=20*(Math.random()-.5),c=e.lighten(i).toString();t.strokeStyle=c,t.lineWidth=a+4*(Math.random()-.5);var h=(Math.random()-.5)*a*.3,d=(Math.random()-.5)*a*.3;t.moveTo(s.current[0]+h,s.current[1]+d),t.lineTo(r[0]+h,r[1]+d),n>2?(t.globalCompositeOperation="multiply",t.globalAlpha=.5*l):(t.globalCompositeOperation="source-over",t.globalAlpha=.8),t.stroke()}s.current=r}else s.current=r},[o,a,l]),endStroke:n(function(r){r.globalAlpha=1,r.globalCompositeOperation="source-over"},[]),cursor:h(a)}}function x(r){var e=r.color,o=void 0===e?"#FF6B35":e,i=r.strokeWidth,a=void 0===i?20:i,u=r.opacity,c=void 0===u?.9:u,l=t();return{name:"Acrylic",startStroke:n(function(r,t){t.globalAlpha=c,t.strokeStyle=o,t.lineCap="round",t.lineJoin="round",t.globalCompositeOperation="source-over",l.current=r},[o,c]),continueStroke:n(function(r,t){if(l.current){t.beginPath(),t.lineWidth=a;var n=2*(Math.random()-.5);t.lineWidth=Math.max(1,a+n);var e=l.current[0]+.3*(r[0]-l.current[0]),o=l.current[1]+.3*(r[1]-l.current[1]),i=l.current[0]+.7*(r[0]-l.current[0]),u=l.current[1]+.7*(r[1]-l.current[1]);t.moveTo(l.current[0],l.current[1]),t.bezierCurveTo(e,o,i,u,r[0],r[1]),t.stroke(),Math.random()>.8&&(t.beginPath(),t.globalAlpha=.3*c,t.lineWidth=.6*a,t.moveTo(l.current[0],l.current[1]),t.lineTo(r[0],r[1]),t.stroke(),t.globalAlpha=c),l.current=r}else l.current=r},[a,c]),endStroke:n(function(r){r.globalAlpha=1},[]),cursor:h(a)}}function I(r){var e=r.color,o=void 0===e?"#DC143C":e,i=r.strokeWidth,a=void 0===i?12:i,u=r.pressure,c=void 0===u?.6:u,l=t();return{name:"Crayon",startStroke:n(function(r,t){t.globalAlpha=c,t.strokeStyle=o,t.lineCap="round",t.lineJoin="round",t.globalCompositeOperation="multiply",l.current=r},[o,c]),continueStroke:n(function(r,t){if(l.current){for(var n=0;n<8;n++){t.beginPath();var e=.4*a,o=n/8*Math.PI*2,i=Math.cos(o)*e*Math.random(),u=Math.sin(o)*e*Math.random();t.lineWidth=Math.max(1,a*(.3+.7*Math.random())),t.globalAlpha=c*(.2+.6*Math.random()),t.moveTo(l.current[0]+i,l.current[1]+u),t.lineTo(r[0]+i,r[1]+u),t.stroke()}l.current=r}else l.current=r},[a,c]),endStroke:n(function(r){r.globalAlpha=1,r.globalCompositeOperation="source-over"},[]),cursor:h(a)}}function E(r){var e=r.strokeWidth,o=void 0===e?30:e,i=r.strength,a=void 0===i?.8:i,u=t(),c=t(),l=t();return{name:"Smudge",startStroke:n(function(r,t){u.current=r,c.current=t.canvas;var n=o,e=Math.max(0,r[0]-n),i=Math.max(0,r[1]-n),a=Math.min(c.current.width-e,2*n),s=Math.min(c.current.height-i,2*n);a>0&&s>0&&(l.current=t.getImageData(e,i,a,s))},[o]),continueStroke:n(function(r,t){if(u.current&&l.current&&c.current){var n=r[0]-u.current[0],e=r[1]-u.current[1];if(!(Math.sqrt(n*n+e*e)<2)){var i=document.createElement("canvas"),s=i.getContext("2d");if(s){i.width=2*o,i.height=2*o,s.putImageData(l.current,0,0),t.globalAlpha=a,t.globalCompositeOperation="source-over";for(var h=0;h<5;h++){var d=(h+1)/5;t.drawImage(i,r[0]-o+n*d*.3,r[1]-o+e*d*.3,2*o,2*o)}var f=o,v=Math.max(0,r[0]-f),m=Math.max(0,r[1]-f),g=Math.min(c.current.width-v,2*f),p=Math.min(c.current.height-m,2*f);g>0&&p>0&&(l.current=t.getImageData(v,m,g,p)),u.current=r}}}else u.current=r},[o,a]),endStroke:n(function(r){r.globalAlpha=1,r.globalCompositeOperation="source-over"},[]),cursor:h(o)}}var j=function(r){if(!r.currentTarget)return[0,0];var t=r.currentTarget.getBoundingClientRect(),n=r.targetTouches[0];return[n.clientX-t.left,n.clientY-t.top]},R=function(r){return[r.nativeEvent.offsetX,r.nativeEvent.offsetY]},D=function(r){return 1==(1&r)},J=e(function(t,e){var a=t.tool,u=t.style,l=t.history,s=t.onStartStroke,h=t.onContinueStroke,d=t.onEndStroke,f=function(r,t){if(null==r)return{};var n,e,o={},i=Object.keys(r);for(e=0;e<i.length;e++)t.indexOf(n=i[e])>=0||(o[n]=r[n]);return o}(t,["tool","style","history","onStartStroke","onContinueStroke","onEndStroke"]),v=r(),g=v[0],p=v[1],k=r(),b=k[0],S=k[1],M=r(!1),y=M[0],C=M[1],P=n(function(r){g&&(g.save(),C(!0),null==a.startStroke||a.startStroke(r,g),null==s||s(r))},[a,g,s]),w=n(function(r){g&&(null==a.continueStroke||a.continueStroke(r,g),null==h||h(r))},[a,g,h]),T=n(function(){C(!1),g&&(null==a.endStroke||a.endStroke(g),null==d||d(),g.restore(),b&&l&&l.pushState(b))},[a,g,b,l,d]),A=n(function(r){y&&w(R(r))},[w,y]),W=n(function(r){y&&w(j(r))},[w,y]),O=n(function(r){y||(r.preventDefault(),P(R(r)))},[y,P]),x=n(function(r){y||P(j(r))},[y,P]),I=n(function(){g&&b&&(g.save(),g.fillStyle="#ffffff",g.fillRect(0,0,b.width,b.height),g.restore(),b&&l&&l.pushState(b))},[g,b,l]),E=n(function(r){if(r){r.width=r.offsetWidth,r.height=r.offsetHeight;var t=r.getContext("2d");S(r),p(t),t&&(t.fillStyle="#ffffff",t.fillRect(0,0,r.width,r.height),t.fillStyle="transparent",l&&(l.setContext(t),l.pushState(r)))}},[l]),J=n(function(r){D(r.buttons)&&!y&&O(r)},[y,O]),B=n(function(r){},[]);return o(function(){if(y&&b){var r=function(r){if(y){var t=b.getBoundingClientRect(),n=[r.clientX-t.left,r.clientY-t.top];(n[0]<0||n[0]>b.width||n[1]<0||n[1]>b.height)&&n[0]>=-50&&n[0]<=b.width+50&&n[1]>=-50&&n[1]<=b.height+50&&w(n)}},t=function(){y&&T()};return document.addEventListener("mousemove",r),document.addEventListener("mouseup",t),function(){document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",t)}}},[y,b,w,T]),i(e,function(){return{download:function(r,t){if(void 0===r&&(r="image.png"),b){var n=document.createElement("a");n.href=b.toDataURL(t),n.download=r,n.click()}},clear:I,getImageAsDataUri:function(r){return null==b?void 0:b.toDataURL(r)},context:g}},[b,g,I]),c("canvas",Object.assign({style:m({cursor:null==a?void 0:a.cursor,touchAction:"none"},u),onTouchStart:x,onMouseDown:O,onMouseEnter:J,onMouseMove:y?A:void 0,onTouchMove:y?W:void 0,onMouseUp:T,onMouseOut:B,onTouchEnd:T,ref:E},f),void 0)}),B=function(r,t){try{var n=new Image;return n.onload=function(){r.canvas.width=n.width,r.canvas.height=n.height,r.drawImage(n,0,0),URL.revokeObjectURL(n.src)},n.src=URL.createObjectURL(t),Promise.resolve()}catch(r){return Promise.reject(r)}};function L(e){var o=t([]),i=t(0),u=r(),c=u[0],l=u[1],s=r(!1),h=s[0],d=s[1],f=r(!1),v=f[0],m=f[1],g=n(function(r){try{var t=i.current;return c?(0!==t&&(o.current=o.current.slice(0,-t),i.current=0),Promise.resolve(new Promise(function(t){return r.toBlob(t)})).then(function(r){return r&&o.current.push(r),e&&o.current.length>e&&(o.current=o.current.slice(-e)),d(o.current.length>1),m(!1),!0})):(console.error("Context not initialised"),Promise.resolve(!1))}catch(r){return Promise.reject(r)}},[i,o,c]),p=n(function(){try{var r=i.current;return c?r+1>=o.current.length?(console.log("nope"),Promise.resolve(!1)):Promise.resolve(B(c,o.current[o.current.length-(r+2)])).then(function(){return i.current++,d(i.current+1<o.current.length),m(!0),!0}):(console.error("Context not initialised"),Promise.resolve(!1))}catch(r){return Promise.reject(r)}},[i,o,c]),k=n(function(){try{var r=i.current;return c?r<=0?Promise.resolve(!1):Promise.resolve(B(c,o.current[o.current.length-r])).then(function(){return i.current--,d(i.current+1<o.current.length),m(i.current>0),!0}):(console.error("Context not initialised"),Promise.resolve(!1))}catch(r){return Promise.reject(r)}},[o,i,c]),b=n(function(){o.current=[]},[o]);return{history:a(function(){return{setContext:function(r){l(r)},pushState:g}},[l,g]),undo:p,redo:k,clear:b,canUndo:h,canRedo:v}}export{J as Artboard,h as circleCursor,R as getMousePoint,j as getTouchPoint,D as mouseButtonIsDown,x as useAcrylic,v as useAirbrush,d as useBrush,A as useCalligraphy,T as useCharcoal,I as useCrayon,P as useEraser,L as useHistory,W as useInkPen,f as useMarker,O as useOilPaint,w as usePencil,p as useShadingBrush,E as useSmudge,C as useWatercolor};
//# sourceMappingURL=index.module.js.map
