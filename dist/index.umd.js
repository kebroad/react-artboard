!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("tinycolor2"),require("react/jsx-runtime")):"function"==typeof define&&define.amd?define(["exports","react","tinycolor2","react/jsx-runtime"],t):t((e||self).reactArtboard={},e.react,e.tinycolor2,e.jsxRuntime)}(this,function(e,t,r,n){function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=o(r);function a(e,t){var r=Math.round(Math.random()*t),n=1-Math.random()/4;return u.default(e).darken(r-t/2).setAlpha(n).toPercentageRgbString()}var i=function(e,t,r){return[r[0]+e*Math.cos(t),r[1]+e*Math.sin(t)]};function c(e){return"url("+function(e){return"data:image/svg+xml;base64,"+btoa(function(e){return"<svg xmlns='http://www.w3.org/2000/svg' width='"+e+"' height='"+e+"' viewBox='0 0 "+e+" "+e+"'><circle r='"+e/2+"' cy='"+e/2+"' cx='"+e/2+"' stroke-width='1' stroke='rgba(0,0,0,0.5)' fill='none'/></svg>"}(e))}(e)+") "+e/2+" "+e/2+", crosshair"}function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var f=null;function h(){var e,t,r,n,o;if(null!==f)e=f,f=null;else{do{n=(t=2*Math.random()-1)*t+(r=2*Math.random()-1)*r}while(0===n||n>=1);e=t*(o=Math.sqrt(-2*Math.log(n)/n)),f=r*o}return e}function d(e,t,r,n,o){if(r<0)return[];var u=(e[1]+t[1])/2,a=[(e[0]+t[0])/2+h()*n,u+h()*n],i=d(e,a,r-1,n/o,o);return i.push(a),i.push.apply(i,d(a,t,r-1,n/o,o)),i}function v(e,t,r){t.beginPath(),function(e,t,r){return function(e,t,r,n){for(var o=[],u=0;u<e.length;u++){var a=e[u],i=e[(u+1)%e.length];o.push(a),o.push.apply(o,d(a,i,5,r,2))}return o}(function(e,t,r){for(var n=2*Math.PI/t,o=[],u=1;u<=t;u++)o.push([r*Math.cos(n*u)+e[0],r*Math.sin(n*u)+e[1]]);return o}(e,t,r),0,r/10)}(e,Math.round(r/5),r).forEach(function(e){t.lineTo.apply(t,e)}),t.closePath(),t.fill()}function g(e,t,r,n){for(var o=Math.min(r,e.length/3),u=0;u<o;u++)n.globalAlpha=.01-.009/o*u,v(e[e.length-3*u-1],n,t+t/o*u);n.globalAlpha=.1}var k=function(e){if(!e.currentTarget)return[0,0];var t=e.currentTarget.getBoundingClientRect(),r=e.targetTouches[0];return[r.clientX-t.left,r.clientY-t.top]},b=function(e){return[e.nativeEvent.offsetX,e.nativeEvent.offsetY]},m=function(e){return 1==(1&e)},p=t.forwardRef(function(e,r){var o=e.tool,u=e.style,a=e.history,i=e.onStartStroke,c=e.onContinueStroke,s=e.onEndStroke,f=function(e,t){if(null==e)return{};var r,n,o={},u=Object.keys(e);for(n=0;n<u.length;n++)t.indexOf(r=u[n])>=0||(o[r]=e[r]);return o}(e,["tool","style","history","onStartStroke","onContinueStroke","onEndStroke"]),h=t.useState(),d=h[0],v=h[1],g=t.useState(),p=g[0],S=g[1],C=t.useState(!1),y=C[0],M=C[1],P=t.useCallback(function(e){d&&(d.save(),M(!0),null==o.startStroke||o.startStroke(e,d),null==i||i(e))},[o,d,i]),w=t.useCallback(function(e){d&&(null==o.continueStroke||o.continueStroke(e,d),null==c||c(e))},[o,d,c]),T=t.useCallback(function(){M(!1),d&&(null==o.endStroke||o.endStroke(d),null==s||s(),d.restore(),p&&a&&a.pushState(p))},[o,d,p,a,s]),R=t.useCallback(function(e){y&&w(b(e))},[w,y]),x=t.useCallback(function(e){y&&w(k(e))},[w,y]),A=t.useCallback(function(e){y||(e.preventDefault(),P(b(e)))},[y,P]),j=t.useCallback(function(e){y||P(k(e))},[y,P]),E=t.useCallback(function(){d&&p&&(d.save(),d.fillStyle="#ffffff",d.fillRect(0,0,p.width,p.height),d.restore(),p&&a&&a.pushState(p))},[d,p,a]),I=t.useCallback(function(e){if(e){e.width=e.offsetWidth,e.height=e.offsetHeight;var t=e.getContext("2d");S(e),v(t),t&&(t.fillStyle="#ffffff",t.fillRect(0,0,e.width,e.height),t.fillStyle="transparent",a&&(a.setContext(t),a.pushState(e)))}},[a]),O=t.useCallback(function(e){m(e.buttons)&&!y&&A(e)},[y,A]),W=t.useCallback(function(e){},[]);return t.useEffect(function(){if(y&&p){var e=function(e){if(y){var t=p.getBoundingClientRect(),r=[e.clientX-t.left,e.clientY-t.top];(r[0]<0||r[0]>p.width||r[1]<0||r[1]>p.height)&&r[0]>=-50&&r[0]<=p.width+50&&r[1]>=-50&&r[1]<=p.height+50&&w(r)}},t=function(){y&&T()};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),function(){document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}}},[y,p,w,T]),t.useImperativeHandle(r,function(){return{download:function(e,t){if(void 0===e&&(e="image.png"),p){var r=document.createElement("a");r.href=p.toDataURL(t),r.download=e,r.click()}},clear:E,getImageAsDataUri:function(e){return null==p?void 0:p.toDataURL(e)},context:d}},[p,d,E]),n.jsx("canvas",Object.assign({style:l({cursor:null==o?void 0:o.cursor,touchAction:"none"},u),onTouchStart:j,onMouseDown:A,onMouseEnter:O,onMouseMove:y?R:void 0,onTouchMove:y?x:void 0,onMouseUp:T,onMouseOut:W,onTouchEnd:T,ref:I},f),void 0)}),S=function(e,t){try{var r=new Image;return r.onload=function(){e.canvas.width=r.width,e.canvas.height=r.height,e.drawImage(r,0,0),URL.revokeObjectURL(r.src)},r.src=URL.createObjectURL(t),Promise.resolve()}catch(e){return Promise.reject(e)}};e.Artboard=p,e.circleCursor=c,e.getMousePoint=b,e.getTouchPoint=k,e.mouseButtonIsDown=m,e.useAirbrush=function(e){var r=e.color,n=void 0===r?"#000000":r,o=e.strokeWidth,a=void 0===o?25:o,i=t.useCallback(function(e,t){t.globalCompositeOperation="darken",t.lineWidth=a,t.lineJoin=t.lineCap="round",t.strokeStyle=n,t.shadowBlur=.5*a,t.shadowColor=u.default(n).setAlpha(.5).toPercentageRgbString(),console.log(t.shadowColor),t.moveTo(e[0],e[1]),t.beginPath()},[n,a]),l=t.useCallback(function(e){e.globalCompositeOperation="source-over"},[]);return{name:"Airbrush",startStroke:i,continueStroke:t.useCallback(function(e,t){t.lineTo(e[0],e[1]),t.stroke()},[]),endStroke:l,cursor:c(a)}},e.useBrush=function(e){var r=e.color,n=void 0===r?"#000000":r,o=e.strokeWidth,u=void 0===o?25:o,l=e.varyBrightness,s=void 0===l?5:l,f=t.useState([]),h=f[0],d=f[1],v=t.useRef(),g=t.useRef();return{name:"Paintbrush",startStroke:t.useCallback(function(e){v.current=void 0,d(function(e,t,r){for(var n=[],o=Math.round(e/3),u=e/o,i=0;i<o;i++){var c=0===i?0:u*i+Math.random()*u/2-u/2;n.push({distance:c,thickness:2*Math.random()+2,colour:a(t,r)})}return n}(u,n,s)),g.current=e},[d,u,n,s]),continueStroke:t.useCallback(function(e,t){if(g.current){var r=(s=v.current,c=g.current,l=e,f=(Math.atan2(l[1]-c[1],l[0]-c[0])-Math.PI/2)%(2*Math.PI),void 0===s?f:s-(n=f,o=2*Math.PI,(a=(s-(n>0?n:n+o)+Math.PI)%o-Math.PI)<-Math.PI?a+o:a));void 0===v.current&&(v.current=r%(2*Math.PI)),function(e,t,r,n,o,u,a){e.forEach(function(e){a.beginPath(),function(e,t,r,n,o){o.beginPath(),o.moveTo(e[0],e[1]),o.strokeStyle=r.colour,o.lineWidth=r.thickness,o.lineCap="round",o.lineJoin="round",o.shadowColor=r.colour,o.shadowBlur=r.thickness/2,o.quadraticCurveTo(n[0],n[1],t[0],t[1]),o.lineTo(t[0],t[1]),o.stroke()}(i(e.distance-u/2,n,t),i(e.distance-u/2,o,r),e,i(e.distance-u/2,o,t),a)})}(h,g.current,e,v.current,r,u,t),v.current=r%(2*Math.PI),g.current=e}else g.current=e;var n,o,a,c,l,s,f},[h,u]),cursor:c(u)}},e.useEraser=function(e){var r=e.strokeWidth,n=void 0===r?25:r;return{name:"Eraser",startStroke:t.useCallback(function(e,t){t.globalCompositeOperation="source-over",t.lineWidth=n,t.strokeStyle="#ffffff",t.lineJoin=t.lineCap="round",t.moveTo(e[0],e[1]),t.beginPath()},[n]),continueStroke:t.useCallback(function(e,t){t.lineTo(e[0],e[1]),t.stroke()},[]),cursor:c(n)}},e.useHistory=function(e){var r=t.useRef([]),n=t.useRef(0),o=t.useState(),u=o[0],a=o[1],i=t.useState(!1),c=i[0],l=i[1],s=t.useState(!1),f=s[0],h=s[1],d=t.useCallback(function(t){try{var o=n.current;return u?(0!==o&&(r.current=r.current.slice(0,-o),n.current=0),Promise.resolve(new Promise(function(e){return t.toBlob(e)})).then(function(t){return t&&r.current.push(t),e&&r.current.length>e&&(r.current=r.current.slice(-e)),l(r.current.length>1),h(!1),!0})):(console.error("Context not initialised"),Promise.resolve(!1))}catch(e){return Promise.reject(e)}},[n,r,u]),v=t.useCallback(function(){try{var e=n.current;return u?e+1>=r.current.length?(console.log("nope"),Promise.resolve(!1)):Promise.resolve(S(u,r.current[r.current.length-(e+2)])).then(function(){return n.current++,l(n.current+1<r.current.length),h(!0),!0}):(console.error("Context not initialised"),Promise.resolve(!1))}catch(e){return Promise.reject(e)}},[n,r,u]),g=t.useCallback(function(){try{var e=n.current;return u?e<=0?Promise.resolve(!1):Promise.resolve(S(u,r.current[r.current.length-e])).then(function(){return n.current--,l(n.current+1<r.current.length),h(n.current>0),!0}):(console.error("Context not initialised"),Promise.resolve(!1))}catch(e){return Promise.reject(e)}},[r,n,u]),k=t.useCallback(function(){r.current=[]},[r]);return{history:t.useMemo(function(){return{setContext:function(e){a(e)},pushState:d}},[a,d]),undo:v,redo:g,clear:k,canUndo:c,canRedo:f}},e.useMarker=function(e){var r=e.color,n=void 0===r?"#000000":r,o=e.strokeWidth,u=void 0===o?25:o,a=t.useRef();return{name:"Marker",startStroke:t.useCallback(function(e,t){t.lineWidth=3,t.lineJoin=t.lineCap="round",a.current=e,t.strokeStyle=n},[n]),continueStroke:t.useCallback(function(e,t){if(a.current){if(a.current[0]!==e[0]||a.current[1]!==e[1]){t.beginPath();for(var r=0;r<u;r+=2){var n=Math.round(u/2-r);t.globalAlpha=1/u*(u-r),t.moveTo(a.current[0]-n,a.current[1]-n),t.lineTo(e[0]-n,e[1]-n),t.stroke()}t.globalAlpha=1,t.beginPath(),a.current=e}}else a.current=e},[u,a]),cursor:c(u)}},e.useShadingBrush=function(e){var r=e.color,n=void 0===r?"#000000":r,o=e.neighbourColor,a=e.distanceThreshold,i=void 0===a?40:a,c=e.neighbourStrokeWidth,l=void 0===c?1:c,f=e.spreadFactor,h=void 0===f?.9:f;o||(o=u.default(n).setAlpha(.2).toPercentageRgbString());var d=t.useRef([]),v=i*i;return{name:"Shading",startStroke:t.useCallback(function(e,t){t.globalCompositeOperation="darken",t.lineWidth=1,t.lineJoin=t.lineCap="round",d.current=[e]},[]),continueStroke:t.useCallback(function(e,t){t.strokeStyle=n,t.lineWidth=1,d.current.push(e),t.beginPath();var r=d.current[d.current.length-2];t.moveTo(r[0],r[1]),t.lineTo.apply(t,e),t.stroke(),t.lineWidth=l;for(var u,a=function(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}(d.current);!(u=a()).done;){var i=u.value,c=i[0]-e[0],f=i[1]-e[1],g=c*c+f*f;g<v&&Math.random()>g/v&&(t.beginPath(),t.strokeStyle=o,t.moveTo(e[0]+c*h,e[1]+f*h),t.lineTo(i[0]-c*h,i[1]-f*h),t.stroke())}},[l,n,h,v,o]),endStroke:t.useCallback(function(e){e.globalCompositeOperation="source-over"},[]),cursor:"crosshair"}},e.useWatercolor=function(e){var r=e.color,n=void 0===r?"#000000":r,o=e.strokeWidth,u=void 0===o?25:o,a=t.useRef([]),i=t.useCallback(function(e,t){t.fillStyle=n,t.shadowColor=n,t.globalAlpha=.01,a.current=[e],g(a.current,1.1*u,1,t)},[n,u]),l=t.useCallback(function(){a.current=[]},[]);return{name:"Watercolor",startStroke:i,continueStroke:t.useCallback(function(e,t){a.current.push(e),g(a.current,u,5,t)},[u]),endStroke:l,cursor:c(u)}}});
//# sourceMappingURL=index.umd.js.map
