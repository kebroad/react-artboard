var e=require("react"),t=require("tinycolor2"),r=require("react/jsx-runtime");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=n(t);function u(e,t){var r=Math.round(Math.random()*t),n=1-Math.random()/4;return o.default(e).darken(r-t/2).setAlpha(n).toPercentageRgbString()}var a=function(e,t,r){return[r[0]+e*Math.cos(t),r[1]+e*Math.sin(t)]};function i(e){return"url("+function(e){return"data:image/svg+xml;base64,"+btoa(function(e){return"<svg xmlns='http://www.w3.org/2000/svg' width='"+e+"' height='"+e+"' viewBox='0 0 "+e+" "+e+"'><circle r='"+e/2+"' cy='"+e/2+"' cx='"+e/2+"' stroke-width='1' stroke='rgba(0,0,0,0.5)' fill='none'/></svg>"}(e))}(e)+") "+e/2+" "+e/2+", crosshair"}function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s=null;function f(){var e,t,r,n,o;if(null!==s)e=s,s=null;else{do{n=(t=2*Math.random()-1)*t+(r=2*Math.random()-1)*r}while(0===n||n>=1);e=t*(o=Math.sqrt(-2*Math.log(n)/n)),s=r*o}return e}function h(e,t,r,n,o){if(r<0)return[];var u=(e[1]+t[1])/2,a=[(e[0]+t[0])/2+f()*n,u+f()*n],i=h(e,a,r-1,n/o,o);return i.push(a),i.push.apply(i,h(a,t,r-1,n/o,o)),i}function d(e,t,r){t.beginPath(),function(e,t,r){return function(e,t,r,n){for(var o=[],u=0;u<e.length;u++){var a=e[u],i=e[(u+1)%e.length];o.push(a),o.push.apply(o,h(a,i,5,r,2))}return o}(function(e,t,r){for(var n=2*Math.PI/t,o=[],u=1;u<=t;u++)o.push([r*Math.cos(n*u)+e[0],r*Math.sin(n*u)+e[1]]);return o}(e,t,r),0,r/10)}(e,Math.round(r/5),r).forEach(function(e){t.lineTo.apply(t,e)}),t.closePath(),t.fill()}function v(e,t,r,n){for(var o=Math.min(r,e.length/3),u=0;u<o;u++)n.globalAlpha=.01-.009/o*u,d(e[e.length-3*u-1],n,t+t/o*u);n.globalAlpha=.1}var g=function(e){if(!e.currentTarget)return[0,0];var t=e.currentTarget.getBoundingClientRect(),r=e.targetTouches[0];return[r.clientX-t.left,r.clientY-t.top]},k=function(e){return[e.nativeEvent.offsetX,e.nativeEvent.offsetY]},p=function(e){return 1==(1&e)},b=e.forwardRef(function(t,n){var o=t.tool,u=t.style,a=t.history,i=t.onStartStroke,l=t.onContinueStroke,s=t.onEndStroke,f=function(e,t){if(null==e)return{};var r,n,o={},u=Object.keys(e);for(n=0;n<u.length;n++)t.indexOf(r=u[n])>=0||(o[r]=e[r]);return o}(t,["tool","style","history","onStartStroke","onContinueStroke","onEndStroke"]),h=e.useState(),d=h[0],v=h[1],b=e.useState(),m=b[0],S=b[1],C=e.useState(!1),y=C[0],M=C[1],P=e.useCallback(function(e){d&&(d.save(),M(!0),null==o.startStroke||o.startStroke(e,d),null==i||i(e))},[o,d,i]),w=e.useCallback(function(e){d&&(null==o.continueStroke||o.continueStroke(e,d),null==l||l(e))},[o,d,l]),x=e.useCallback(function(){M(!1),d&&(null==o.endStroke||o.endStroke(d),null==s||s(),d.restore(),m&&a&&a.pushState(m))},[o,d,m,a,s]),T=e.useCallback(function(e){y&&w(k(e))},[w,y]),R=e.useCallback(function(e){y&&w(g(e))},[w,y]),A=e.useCallback(function(e){y||(e.preventDefault(),P(k(e)))},[y,P]),E=e.useCallback(function(e){y||P(g(e))},[y,P]),I=e.useCallback(function(){d&&m&&(d.save(),d.fillStyle="#ffffff",d.fillRect(0,0,m.width,m.height),d.restore(),m&&a&&a.pushState(m))},[d,m,a]),j=e.useCallback(function(e){if(e){e.width=e.offsetWidth,e.height=e.offsetHeight;var t=e.getContext("2d");S(e),v(t),t&&(t.fillStyle="#ffffff",t.fillRect(0,0,e.width,e.height),t.fillStyle="transparent",a&&(a.setContext(t),a.pushState(e)))}},[a]),O=e.useCallback(function(e){p(e.buttons)&&!y&&A(e)},[y,A]),W=e.useCallback(function(e){},[]);return e.useEffect(function(){if(y&&m){var e=function(e){if(y){var t=m.getBoundingClientRect(),r=[e.clientX-t.left,e.clientY-t.top];(r[0]<0||r[0]>m.width||r[1]<0||r[1]>m.height)&&r[0]>=-50&&r[0]<=m.width+50&&r[1]>=-50&&r[1]<=m.height+50&&w(r)}},t=function(){y&&x()};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),function(){document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}}},[y,m,w,x]),e.useImperativeHandle(n,function(){return{download:function(e,t){if(void 0===e&&(e="image.png"),m){var r=document.createElement("a");r.href=m.toDataURL(t),r.download=e,r.click()}},clear:I,getImageAsDataUri:function(e){return null==m?void 0:m.toDataURL(e)},context:d}},[m,d,I]),r.jsx("canvas",Object.assign({style:c({cursor:null==o?void 0:o.cursor,touchAction:"none"},u),onTouchStart:E,onMouseDown:A,onMouseEnter:O,onMouseMove:y?T:void 0,onTouchMove:y?R:void 0,onMouseUp:x,onMouseOut:W,onTouchEnd:x,ref:j},f),void 0)}),m=function(e,t){try{var r=new Image;return r.onload=function(){e.canvas.width=r.width,e.canvas.height=r.height,e.drawImage(r,0,0),URL.revokeObjectURL(r.src)},r.src=URL.createObjectURL(t),Promise.resolve()}catch(e){return Promise.reject(e)}};exports.Artboard=b,exports.circleCursor=i,exports.getMousePoint=k,exports.getTouchPoint=g,exports.mouseButtonIsDown=p,exports.useAirbrush=function(t){var r=t.color,n=void 0===r?"#000000":r,u=t.strokeWidth,a=void 0===u?25:u,c=e.useCallback(function(e,t){t.globalCompositeOperation="darken",t.lineWidth=a,t.lineJoin=t.lineCap="round",t.strokeStyle=n,t.shadowBlur=.5*a,t.shadowColor=o.default(n).setAlpha(.5).toPercentageRgbString(),console.log(t.shadowColor),t.moveTo(e[0],e[1]),t.beginPath()},[n,a]),l=e.useCallback(function(e){e.globalCompositeOperation="source-over"},[]);return{name:"Airbrush",startStroke:c,continueStroke:e.useCallback(function(e,t){t.lineTo(e[0],e[1]),t.stroke()},[]),endStroke:l,cursor:i(a)}},exports.useBrush=function(t){var r=t.color,n=void 0===r?"#000000":r,o=t.strokeWidth,c=void 0===o?25:o,l=t.varyBrightness,s=void 0===l?5:l,f=e.useState([]),h=f[0],d=f[1],v=e.useRef(),g=e.useRef();return{name:"Paintbrush",startStroke:e.useCallback(function(e){v.current=void 0,d(function(e,t,r){for(var n=[],o=Math.round(e/3),a=e/o,i=0;i<o;i++){var c=0===i?0:a*i+Math.random()*a/2-a/2;n.push({distance:c,thickness:2*Math.random()+2,colour:u(t,r)})}return n}(c,n,s)),g.current=e},[d,c,n,s]),continueStroke:e.useCallback(function(e,t){if(g.current){var r=(s=v.current,i=g.current,l=e,f=(Math.atan2(l[1]-i[1],l[0]-i[0])-Math.PI/2)%(2*Math.PI),void 0===s?f:s-(n=f,o=2*Math.PI,(u=(s-(n>0?n:n+o)+Math.PI)%o-Math.PI)<-Math.PI?u+o:u));void 0===v.current&&(v.current=r%(2*Math.PI)),function(e,t,r,n,o,u,i){e.forEach(function(e){i.beginPath(),function(e,t,r,n,o){o.beginPath(),o.moveTo(e[0],e[1]),o.strokeStyle=r.colour,o.lineWidth=r.thickness,o.lineCap="round",o.lineJoin="round",o.shadowColor=r.colour,o.shadowBlur=r.thickness/2,o.quadraticCurveTo(n[0],n[1],t[0],t[1]),o.lineTo(t[0],t[1]),o.stroke()}(a(e.distance-u/2,n,t),a(e.distance-u/2,o,r),e,a(e.distance-u/2,o,t),i)})}(h,g.current,e,v.current,r,c,t),v.current=r%(2*Math.PI),g.current=e}else g.current=e;var n,o,u,i,l,s,f},[h,c]),cursor:i(c)}},exports.useEraser=function(t){var r=t.strokeWidth,n=void 0===r?25:r;return{name:"Eraser",startStroke:e.useCallback(function(e,t){t.globalCompositeOperation="source-over",t.lineWidth=n,t.strokeStyle="#ffffff",t.lineJoin=t.lineCap="round",t.moveTo(e[0],e[1]),t.beginPath()},[n]),continueStroke:e.useCallback(function(e,t){t.lineTo(e[0],e[1]),t.stroke()},[]),cursor:i(n)}},exports.useHistory=function(t){var r=e.useRef([]),n=e.useRef(0),o=e.useState(),u=o[0],a=o[1],i=e.useState(!1),c=i[0],l=i[1],s=e.useState(!1),f=s[0],h=s[1],d=e.useCallback(function(e){try{var o=n.current;return u?(0!==o&&(r.current=r.current.slice(0,-o),n.current=0),Promise.resolve(new Promise(function(t){return e.toBlob(t)})).then(function(e){return e&&r.current.push(e),t&&r.current.length>t&&(r.current=r.current.slice(-t)),l(r.current.length>1),h(!1),!0})):(console.error("Context not initialised"),Promise.resolve(!1))}catch(e){return Promise.reject(e)}},[n,r,u]),v=e.useCallback(function(){try{var e=n.current;return u?e+1>=r.current.length?(console.log("nope"),Promise.resolve(!1)):Promise.resolve(m(u,r.current[r.current.length-(e+2)])).then(function(){return n.current++,l(n.current+1<r.current.length),h(!0),!0}):(console.error("Context not initialised"),Promise.resolve(!1))}catch(e){return Promise.reject(e)}},[n,r,u]),g=e.useCallback(function(){try{var e=n.current;return u?e<=0?Promise.resolve(!1):Promise.resolve(m(u,r.current[r.current.length-e])).then(function(){return n.current--,l(n.current+1<r.current.length),h(n.current>0),!0}):(console.error("Context not initialised"),Promise.resolve(!1))}catch(e){return Promise.reject(e)}},[r,n,u]),k=e.useCallback(function(){r.current=[]},[r]);return{history:e.useMemo(function(){return{setContext:function(e){a(e)},pushState:d}},[a,d]),undo:v,redo:g,clear:k,canUndo:c,canRedo:f}},exports.useMarker=function(t){var r=t.color,n=void 0===r?"#000000":r,o=t.strokeWidth,u=void 0===o?25:o,a=e.useRef();return{name:"Marker",startStroke:e.useCallback(function(e,t){t.lineWidth=3,t.lineJoin=t.lineCap="round",a.current=e,t.strokeStyle=n},[n]),continueStroke:e.useCallback(function(e,t){if(a.current){if(a.current[0]!==e[0]||a.current[1]!==e[1]){t.beginPath();for(var r=0;r<u;r+=2){var n=Math.round(u/2-r);t.globalAlpha=1/u*(u-r),t.moveTo(a.current[0]-n,a.current[1]-n),t.lineTo(e[0]-n,e[1]-n),t.stroke()}t.globalAlpha=1,t.beginPath(),a.current=e}}else a.current=e},[u,a]),cursor:i(u)}},exports.useShadingBrush=function(t){var r=t.color,n=void 0===r?"#000000":r,u=t.neighbourColor,a=t.distanceThreshold,i=void 0===a?40:a,c=t.neighbourStrokeWidth,s=void 0===c?1:c,f=t.spreadFactor,h=void 0===f?.9:f;u||(u=o.default(n).setAlpha(.2).toPercentageRgbString());var d=e.useRef([]),v=i*i;return{name:"Shading",startStroke:e.useCallback(function(e,t){t.globalCompositeOperation="darken",t.lineWidth=1,t.lineJoin=t.lineCap="round",d.current=[e]},[]),continueStroke:e.useCallback(function(e,t){t.strokeStyle=n,t.lineWidth=1,d.current.push(e),t.beginPath();var r=d.current[d.current.length-2];t.moveTo(r[0],r[1]),t.lineTo.apply(t,e),t.stroke(),t.lineWidth=s;for(var o,a=function(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}(d.current);!(o=a()).done;){var i=o.value,c=i[0]-e[0],f=i[1]-e[1],g=c*c+f*f;g<v&&Math.random()>g/v&&(t.beginPath(),t.strokeStyle=u,t.moveTo(e[0]+c*h,e[1]+f*h),t.lineTo(i[0]-c*h,i[1]-f*h),t.stroke())}},[s,n,h,v,u]),endStroke:e.useCallback(function(e){e.globalCompositeOperation="source-over"},[]),cursor:"crosshair"}},exports.useWatercolor=function(t){var r=t.color,n=void 0===r?"#000000":r,o=t.strokeWidth,u=void 0===o?25:o,a=e.useRef([]),c=e.useCallback(function(e,t){t.fillStyle=n,t.shadowColor=n,t.globalAlpha=.01,a.current=[e],v(a.current,1.1*u,1,t)},[n,u]),l=e.useCallback(function(){a.current=[]},[]);return{name:"Watercolor",startStroke:c,continueStroke:e.useCallback(function(e,t){a.current.push(e),v(a.current,u,5,t)},[u]),endStroke:l,cursor:i(u)}};
//# sourceMappingURL=index.js.map
